/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{573:function(wa,ta,h){h.r(ta);var pa=h(0),na=h(7),oa=h(3);wa=h(54);var ka=h(33),la=h(14);h=function(){function ha(){this.init()}ha.prototype.init=function(){this.dja=!1;this.dg=this.Sn=this.connection=null;this.sv={};this.ga=this.cL=null};ha.prototype.DEa=function(aa){for(var y=this,r=0;r<aa.length;++r){var n=aa[r];switch(n.at){case "create":this.sv[n.author]||(this.sv[n.author]=n.aName);this.Tsa(n);break;case "modify":this.ga.ar(n.xfdf).then(function(e){y.ga.wb(e[0])});
break;case "delete":this.ga.ar("<delete><id>"+n.aId+"</id></delete>")}}};ha.prototype.Tsa=function(aa){var y=this;this.ga.ar(aa.xfdf).then(function(r){r=r[0];r.authorId=aa.author;y.ga.wb(r);y.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[r])})};ha.prototype.osa=function(aa,y,r){this.Sn&&this.Sn(aa,y,r)};ha.prototype.preloadAnnotations=function(aa){this.addEventListener("webViewerServerAnnotationsEnabled",this.osa.bind(this,aa,"add",{imported:!1}),{once:!0})};ha.prototype.initiateCollaboration=function(aa,
y,r){var n=this;if(aa){n.dg=y;n.ga=r.ma();r.addEventListener(na.h.DOCUMENT_UNLOADED,function(){n.disableCollaboration()});n.kFa(aa);var e=new XMLHttpRequest;e.addEventListener("load",function(){if(200===e.status&&0<e.responseText.length)try{var b=JSON.parse(e.responseText);n.connection=exports.da.ZFa(Object(ka.k)(n.dg,"blackbox/"),"annot");n.cL=b.id;n.sv[b.id]=b.user_name;n.ga.dU(b.id);n.connection.oJa(function(f){f.t&&f.t.startsWith("a_")&&f.data&&n.DEa(f.data)},function(){n.connection.send({t:"a_retrieve",
dId:aa});n.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[n.sv[b.id],n.cL])},function(){n.disableCollaboration()})}catch(f){Object(oa.g)(f.message)}});e.open("GET",Object(ka.k)(this.dg,"demo/SessionInfo.jsp"));e.withCredentials=!0;e.send();n.dja=!0;n.ga.l9(function(b){return n.sv[b.Author]||b.Author})}else Object(oa.g)("Document ID required for collaboration")};ha.prototype.disableCollaboration=function(){this.Sn&&(this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Sn),this.Sn=
null);this.connection&&this.connection.Ss();this.ga&&this.ga.dU("Guest");this.init();this.trigger(ha.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ha.prototype.kFa=function(aa){var y=this;this.Sn&&this.ga.removeEventListener(la.a.Events.ANNOTATION_CHANGED,this.Sn);this.Sn=function(r,n,e){return Object(pa.b)(this,void 0,void 0,function(){var b,f,a,w,ea,ba,ca,x,fa;return Object(pa.d)(this,function(z){switch(z.label){case 0:if(e.imported)return[2];b={t:"a_"+n,dId:aa,annots:[]};return[4,y.ga.Y0()];case 1:f=
z.ba();"delete"!==n&&(a=(new DOMParser).parseFromString(f,"text/xml"),w=new XMLSerializer);for(ea=0;ea<r.length;ea++)ba=r[ea],x=ca=void 0,"add"===n?(ca=a.querySelector('[name="'+ba.Id+'"]'),x=w.serializeToString(ca),fa=null,ba.InReplyTo&&(fa=y.ga.Ug(ba.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:ba.Id,author:y.cL,aName:y.sv[y.cL],parent:fa,xfdf:"<add>"+x+"</add>"})):"modify"===n?(ca=a.querySelector('[name="'+ba.Id+'"]'),x=w.serializeToString(ca),b.annots.push({at:"modify",aId:ba.Id,
xfdf:"<modify>"+x+"</modify>"})):"delete"===n&&b.annots.push({at:"delete",aId:ba.Id});0<b.annots.length&&y.connection.send(b);return[2]}})})}.bind(y);this.ga.addEventListener(la.a.Events.ANNOTATION_CHANGED,this.Sn)};ha.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ha}();Object(wa.a)(h);ta["default"]=h}}]);}).call(this || window)
